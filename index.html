<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mi Lista de Películas y Series</title>
  <style>
    body { font-family:"Segoe UI",Arial,sans-serif; background:#0d253f; color:white; margin:20px;}
    h1 { text-align:center; color:#01b4e4; font-size:2.5em;}
    h2 { color:#01b4e4; font-size:2em; margin-top:40px;}
    .contenedor { display:flex; flex-wrap:wrap;}
    .pelicula { display:inline-block; margin:20px; text-align:center; width:200px; position:relative;}
    .pelicula img { width:100%; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.5);}
    .pelicula p { margin-top:8px; font-size:1.05em; color:white; font-weight:normal;}
    .rating-circle { position:absolute; bottom:0; left:0; transform:translate(-40%,-40%); width:48px; height:48px;}
    .rating-circle svg { transform:rotate(-90deg);}
    .rating-text { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:0.8em; font-weight:bold; color:white;}
    .progress { transition:stroke-dashoffset 1.5s ease;}
    .popup { 
      position:absolute; 
      top:0; left:0; 
      width:100%; height:100%; 
      background:rgba(0,0,0,0.85); 
      backdrop-filter:blur(8px);
      color:white; 
      opacity:0; 
      transition:opacity 0.3s ease; 
      border-radius:8px; 
      padding:10px; 
      box-sizing:border-box; 
      font-size:0.9em; 
      overflow-y:auto; 
      z-index:1000;
    }
    .pelicula:hover .popup { opacity:1;}
    .popup h3 { margin:0; color:#01b4e4; font-size:1em; font-weight:normal;}
    .popup p { margin:2px 0; font-weight:normal;}
    .filtro { text-align:right; margin:20px;}
    .filtro label { color:#01b4e4; font-weight:bold; margin-right:10px;}
  </style>
</head>
<body>
  <h1>Mi Lista de Películas y Series</h1>

  <div class="filtro">
    <label for="filtro">Filtro:</label>
    <select id="filtro">
      <option value="none">Sin filtro</option>
      <option value="alfabetico">Alfabético</option>
      <option value="anio">Año</option>
    </select>
  </div>

  <h2>Películas</h2>
  <div id="peliculas" class="contenedor"></div>

  <h2>Series</h2>
  <div id="series" class="contenedor"></div>

  <script>
    const apiKey = "86f6772a666a8617d6b629fa9a4b3c62";  
    const movieIds = [238,603,597,496243,27205,155,680,122,13,550,424,862,314];
    const seriesIds = [1399,60735,1668,1412,456,4629,66732,1100];

    let peliculasData = [];
    let seriesData = [];

    async function getDirector(id) {
      const res = await fetch(`https://api.themoviedb.org/3/movie/${id}/credits?api_key=${apiKey}`);
      const data = await res.json();
      const director = data.crew.find(c => c.job === "Director");
      return director ? director.name : "Desconocido";
    }

    function renderItem(data, type, containerId, director="") {
      const rating = data.vote_average * 10;
      const radius = 20;
      const circumference = 2 * Math.PI * radius;
      const offset = circumference - (rating/100)*circumference;
      let color = rating>=70 ? "#21d07a" : rating>=40 ? "#d2d531" : "#db2360";
      const genres = data.genres.map(g=>g.name).join(", ");

      const div = document.createElement("div");
      div.className="pelicula";
      div.innerHTML=`
        <a href="https://www.themoviedb.org/${type}/${data.id}" target="_blank">
          <img src="https://image.tmdb.org/t/p/w300${data.poster_path}" alt="${data.title||data.name}">
          <p>${data.title||data.name}</p>
          <div class="rating-circle">
            <svg width="48" height="48">
              <circle cx="24" cy="24" r="${radius}" stroke="#444" stroke-width="3" fill="black"/>
              <circle class="progress" cx="24" cy="24" r="${radius}" stroke="${color}" stroke-width="3" fill="transparent"
                stroke-dasharray="${circumference}" stroke-dashoffset="${circumference}"/>
            </svg>
            <div class="rating-text">${data.vote_average.toFixed(1)}</div>
          </div>
          <div class="popup">
            <h3>${data.title||data.name}</h3>
            <p><strong>Estreno:</strong> ${data.release_date||data.first_air_date}</p>
            ${type==="movie"?`<p><strong>Director:</strong> ${director}</p>`:""}
            <p><strong>Género:</strong> ${genres}</p>
            <p>${data.overview}</p>
          </div>
        </a>`;
      document.getElementById(containerId).appendChild(div);
      setTimeout(()=>{div.querySelector(".progress").setAttribute("stroke-dashoffset",offset);},100);
    }

    // Cargar películas
    (async function(){
      for(let id of movieIds){
        const res = await fetch(`https://api.themoviedb.org/3/movie/${id}?api_key=${apiKey}&language=es-ES`);
        const data = await res.json();
        const director = await getDirector(id);
        peliculasData.push({...data,director});
        renderItem(data,"movie","peliculas",director);
      }
    })();

    // Cargar series
    (async function(){
      for(let id of seriesIds){
        const res = await fetch(`https://api.themoviedb.org/3/tv/${id}?api_key=${apiKey}&language=es-ES`);
        const data = await res.json();
        seriesData.push(data);
        renderItem(data,"tv","series");
      }
    })();

    // Funciones de filtro
    function ordenarPorTitulo(lista, contenedorId, type){
      document.getElementById(contenedorId).innerHTML="";
      lista.sort((a,b)=>(a.title||a.name).localeCompare(b.title||b.name))
           .forEach(item=>renderItem(item,type,contenedorId,item.director||""));
    }
    function ordenarPorAnio(lista, contenedorId, type){
      document.getElementById(contenedorId).innerHTML="";
      lista.sort((a,b)=>(a.release_date||a.first_air_date).localeCompare(b.release_date||b.first_air_date))
           .forEach(item=>renderItem(item,type,contenedorId,item.director||""));
    }

    // Listener del filtro
    document.getElementById("filtro").addEventListener("change",function(){
      const valor=this.value;
      if(valor==="alfabetico"){
        ordenarPorTitulo(peliculasData,"peliculas","movie");
        ordenarPorTitulo(seriesData,"series","tv");
      } else if(valor==="anio"){
        ordenarPorAnio(peliculasData,"peliculas","movie");
        ordenarPorAnio(seriesData,"series","tv");
      } else {
        // Sin filtro: volver a mostrar todo
        document.getElementById("peliculas").innerHTML="";
        peliculasData.forEach(item=>renderItem(item,"movie","peliculas",item.director||""));
        document.getElementById("series").innerHTML="";
        seriesData.forEach(item=>renderItem(item,"tv","series"));
      }
    });
  </script>
</body>
</html>
